---
import '../styles/global.css';

const { title } = Astro.props;
const base = import.meta.env.BASE_URL ?? '/';
const gaMeasurementId =
  import.meta.env.PUBLIC_GA_MEASUREMENT_ID ?? import.meta.env.GA_MEASUREMENT_ID;
const gtmId = import.meta.env.PUBLIC_GTM_ID ?? import.meta.env.GTM_ID;
---
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title ? `${title} | OpenTab` : 'OpenTab'}</title>
    <link rel="icon" type="image/ico" href={`${base}favicon.ico`} />
    {
      gaMeasurementId && (
        <>
          <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaMeasurementId}`} />
          <script
            is:inline
          >{`window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '${gaMeasurementId}');`}</script>
        </>
      )
    }
    {
      gtmId && (
        <script
          is:inline
        >{`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','${gtmId}');`}</script>
      )
    }
  </head>
  <body>
    {
      gtmId && (
        <noscript>
          <iframe
            src={`https://www.googletagmanager.com/ns.html?id=${gtmId}`}
            height="0"
            width="0"
            style="display:none;visibility:hidden"
          ></iframe>
        </noscript>
      )
    }
    <header class="site-header">
      <div class="container">
        <a
          class="logo"
          href={base}
          aria-label="OpenTab home"
          style={`--logo-url: url('${base}logofull.png')`}
        ></a>
        <nav class="nav">
          <a href={`${base}spec`}>Spec</a>
          <a href={`${base}examples`}>Examples</a>
          <a href={`${base}editors/vscode`}>VS Code</a>
          <a href={`${base}try-it`}>Try It</a>
          <a href={`${base}roadmap`}>Roadmap</a>
          <a href="https://github.com/homeputers/opentab" target="_blank" rel="noreferrer">GitHub</a>
        </nav>
      </div>
    </header>
    <main class="container">
      <slot />
    </main>
    <footer class="site-footer">
      <div class="container">
        <span>OpenTab is released under the MIT License.</span>
        <div class="footer-links">
          <a
            href="https://github.com/homeputers/opentab/blob/main/spec/opentab-spec-v0.1.md"
            target="_blank"
            rel="noreferrer"
          >
            Spec in repo
          </a>
          <a
            href={`${base}editors/vscode`}
          >
            VS Code extension
          </a>
          <a
            href="https://github.com/homeputers/opentab/tree/main/samples"
            target="_blank"
            rel="noreferrer"
          >
            Samples
          </a>
          <a href="https://github.com/homeputers/opentab" target="_blank" rel="noreferrer">
            View the repository on GitHub
          </a>
        </div>
      </div>
    </footer>
    <script type="module">
      const ensureCopyButtons = () => {
        document.querySelectorAll("pre").forEach((pre) => {
          if (pre.parentElement?.classList.contains("code-block")) {
            return;
          }

          const wrapper = document.createElement("div");
          wrapper.className = "code-block";

          const button = document.createElement("button");
          button.type = "button";
          button.className = "copy-button";
          button.setAttribute("aria-label", "Copy code to clipboard");
          button.textContent = "Copy";

          const updateButton = (label) => {
            button.textContent = label;
            button.classList.toggle("copied", label === "Copied");
          };

          button.addEventListener("click", async () => {
            const code = pre.querySelector("code")?.innerText ?? pre.innerText;
            try {
              await navigator.clipboard.writeText(code);
              updateButton("Copied");
            } catch (error) {
              const textarea = document.createElement("textarea");
              textarea.value = code;
              textarea.setAttribute("readonly", "true");
              textarea.style.position = "absolute";
              textarea.style.left = "-9999px";
              document.body.appendChild(textarea);
              textarea.select();
              document.execCommand("copy");
              document.body.removeChild(textarea);
              updateButton("Copied");
            }

            window.setTimeout(() => updateButton("Copy"), 2000);
          });

          pre.parentNode?.insertBefore(wrapper, pre);
          wrapper.appendChild(pre);
          wrapper.appendChild(button);
        });
      };

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", ensureCopyButtons);
      } else {
        ensureCopyButtons();
      }
    </script>
  </body>
</html>
