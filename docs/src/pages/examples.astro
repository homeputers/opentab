---
import { readFile, readdir } from 'node:fs/promises';
import path from 'node:path';
import Layout from '../components/Layout.astro';

const samplesDir = new URL('../../../samples/', import.meta.url);
const sampleFiles = (await readdir(samplesDir, { withFileTypes: true }))
  .filter((entry) => entry.isFile())
  .map((entry) => entry.name)
  .sort((a, b) => a.localeCompare(b));

const samples = await Promise.all(
  sampleFiles.map(async (file) => {
    const content = await readFile(new URL(file, samplesDir), 'utf-8');
    return {
      name: file,
      slug: path.parse(file).name,
      content
    };
  })
);
---

<Layout title="Examples">
  <h1 class="page-title">Examples</h1>
  <p>Each OpenTab sample highlights a single concept or technique.</p>

  <section class="section">
    <h2>Sample index</h2>
    <ul class="table-list">
      {samples.map((sample) => (
        <li><a href={`#${sample.slug}`}>{sample.name}</a></li>
      ))}
    </ul>
  </section>

  {samples.map((sample) => (
    <section class="section" id={sample.slug}>
      <h3>{sample.name}</h3>
      <pre><code>{sample.content}</code></pre>
    </section>
  ))}
</Layout>
